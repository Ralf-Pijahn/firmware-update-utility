<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  
  <?include config.wxi?> 

  <Product Id="A274944E-E9AB-4BD0-9041-7C453BF448F8" Name="!(wix.ProductName)" Language="1033" Version="$(var.PRODUCTVERSION)" Manufacturer="!(wix.Manufacturer)" UpgradeCode="b2298b15-232c-4f45-8863-baee41c13b06">
		<Package InstallerVersion="200" Description="TruDose Firmware Update Utility $(var.PRODUCTVERSION)" Comments="Thermo Scientific TruDose Firmware Update Utility Installer" Compressed="yes" InstallScope="perMachine" />

    <WixVariable Id="Manufacturer" Value="Thermo Fisher Scientific"/>
    <WixVariable Id="ProductName" Value="TruDose Firmware Update Tool"/>
    <WixVariable Id="InstallPathProductName" Value="TruDoseFirmareUpdater"/>
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />

    <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLLOCATION" />
    <UIRef Id="WixUI_InstallDir" />
    <Icon Id="icon.ico" SourceFile="$(var.SourceDir)\system_software_update.ico"/>
    <Property Id="ARPPRODUCTICON" Value="icon.ico" />



    <Feature Id="ProductFeature" Title="FirmwareUpdateInstaller" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

    <!-- If we don't set and then use WINDOWSVOLUME then the AllUsersProfile directory will pick the drive with the most space, not the main system drive (c:) -->
    <SetDirectory Id="WINDOWSVOLUME" Value="[WindowsVolume]"/>

  </Product>

	<Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="WINDOWSVOLUME" >
        <Directory Id="ProgramFilesFolder">
          <Directory Id="ThermoFolder" Name="Thermo Scientific">
            <Directory Id="INSTALLLOCATION" Name="TruDose Firmware Update Tool" />
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="ThermoSciFolder" Name="Thermo Scientific">
          <Directory Id="ApplicationProgramsFolder" Name="TruDose Firmware Update Tool"/>
        </Directory>
      </Directory>
    </Directory>

    <!--Start Menu Shortcut - note that the target reference here is a bit suspect, being a Heat autogenerated id.  We should pull the exe out into a known fragment and exclude it from Heat to make this safe -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="799FD192-2287-473A-AA97-69C12B7023AD">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="TruDose Firmware Update Tool"
                  Description="Thermo Fisher Scientific TruDose Firmware Update Tool"
                  Target="[!filD3444C694FBD9A716E14ECCDC631F694]"
                  WorkingDirectory="APPLICATIONROOTDIRECTORY"/>
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
        <RemoveFolder Id="AppThermoFolder" Directory="ThermoSciFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\ThermoFisherScientific\TruDoseFirmwareUpdater" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>
  </Fragment>

  
 
</Wix>